In other words, you did:

ejs
Copy
Edit
<!-- in apartment‐security.ejs -->
<head>
  <%- include('../Partials/meta-tags-service', serviceData) %>
  <%- include('../Partials/performance-optimization') %>
  …
</head>
When you call include('../Partials/meta-tags-service', serviceData), that partial computes safeServiceData inside its own local scope. But once EJS returns to apartment-security.ejs, neither serviceData nor safeServiceData remain in the parent’s locals. Therefore, as soon as you do:

ejs
Copy
Edit
<%- include('../Partials/performance-optimization') %>
inside performance-optimization.ejs you get:

csharp
Copy
Edit
safeServiceData is not defined
How to fix it
You need to make sure that before you include any other partial that references safeServiceData, you bring in those helper‐functions and build safeServiceData at the top level of apartment-security.ejs. That way, every subsequent include can see it.

Step 1: Move your “helpers + safeServiceData” logic into one file
You already have meta-helpers.ejs which defines:

ejs
Copy
Edit
<%
// ────────────────────────────────────────────────────────────────────────────────
// meta-helpers.ejs
//
//   • Declares truncateTitle(…), truncateDescription(…), generateDynamicKeywords(…)
//   • Unpacks locals.serviceData (if it exists) into individual variables
//   • Builds the single `safeServiceData = { … }` object with all defaults
// ────────────────────────────────────────────────────────────────────────────────

// Helper function: truncateTitle
function truncateTitle(title, maxLength = 58) {
  if (!title) return 'Security Services | ShieldWise';
  const suffix = ' | ShieldWise';
  const maxTitleLength = maxLength - suffix.length;
  if (title.length > maxTitleLength) {
    return title.substring(0, maxTitleLength).trim() + '...' + suffix;
  } else {
    return title + suffix;
  }
}

// Helper function: truncateDescription
function truncateDescription(desc, maxLength = 155) {
  if (!desc) {
    return 'Professional security services in California. BSIS licensed guards, 24/7 monitoring. Call 1-800-SHIELD-1 for free assessment.';
  }
  if (desc.length > maxLength) {
    return desc.substring(0, maxLength).trim() + '...';
  }
  return desc;
}

// Helper function: generateDynamicKeywords
function generateDynamicKeywords(baseKeywords, serviceType, location = 'California') {
  const base = baseKeywords || '';
  const dynamic = `${serviceType} security, ${location} security company, licensed security guards, 24/7 security services`;
  return base + (base ? ', ' : '') + dynamic;
}

// Unpack locals.serviceData (if any)
const {
  serviceTitle,
  serviceDescription,
  serviceKeywords,
  serviceImage,
  serviceUrl,
  serviceType,
  serviceBenefit,
  propertyType,
  priceRange,
  serviceAltName,
  serviceOutput,
  audienceType
} = typeof locals.serviceData !== 'undefined' ? serviceData : {};

// Build `safeServiceData` with defaults
const safeServiceData = {
  serviceTitle:       serviceTitle       || 'Professional Security Services',
  serviceDescription: serviceDescription || 'Professional security services with licensed guards and 24/7 monitoring.',
  serviceKeywords:    serviceKeywords    || 'security services, security guards',
  serviceImage:       serviceImage       || 'default-security-service.webp',
  serviceUrl:         serviceUrl         || 'security-services',
  serviceType:        serviceType        || 'security',
  serviceBenefit:     serviceBenefit     || 'enhanced protection and peace of mind',
  propertyType:       propertyType       || 'property',
  priceRange:         priceRange         || { low: 35, mid: 55, high: 85 },
  serviceAltName:     serviceAltName     || 'Security Guard Services',
  serviceOutput:      serviceOutput      || 'Enhanced security and protection',
  audienceType:       audienceType       || 'Property Managers and Business Owners'
};
%>
Make sure this file is saved as:

bash
Copy
Edit
/views/Partials/meta-helpers.ejs
Step 2: In every EJS that needs safeServiceData, include meta-helpers.ejs first
Specifically, open up your /views/services/apartment-security.ejs and put:

ejs
Copy
Edit
<%- include('../Partials/meta-helpers', { serviceData: serviceData }) %>
<head>
  <%- include('../Partials/meta-tags-service') %>
  <%- include('../Partials/performance-optimization') %>
  <%- include('../Partials/mobile-app-meta') %>
  <!-- …etc.… -->
Because you called

ejs
Copy
Edit
<%- include('../Partials/meta-helpers', { serviceData: serviceData }) %>
at the top of apartment-security.ejs, now safeServiceData is in the parent locals. That means:

Inside meta-tags-service.ejs, you do NOT need to pass serviceData again; the moment you included meta-helpers.ejs at the top‐level, EJS already set up safeServiceData and the helper functions.

Inside performance-optimization.ejs, you can safely refer to <%= safeServiceData.serviceType %> because it’s been defined by meta-helpers.ejs at the very top of the parent template.

ˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆ
Putting it all together
Below is a full example of what your apartment‐security.ejs should look like. Every include that expects safeServiceData will now work, because meta-helpers.ejs ran first.

ejs
Copy
Edit
<%-
  //
  // /views/services/apartment-security.ejs
  // (Make sure this file is named exactly "apartment-security.ejs" and lives under /views/services/)
  // 
  // The very first line below brings in our helper functions and builds `safeServiceData`.
  // We pass in `serviceData` (the object from Express) so that meta-helpers.ejs can unpack it.
  //
%>
<%- include('../Partials/meta-helpers', { serviceData: serviceData }) %>

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Now safeServiceData & all helper functions exist in the parent scope. -->
    <!-- We can include meta-tags-service WITHOUT passing serviceData again, 
         because safeServiceData is already in locals. -->
    <%- include('../Partials/meta-tags-service') %>

    <!-- performance-optimization.ejs can now use <%= safeServiceData.serviceType %> without error -->
    <%- include('../Partials/performance-optimization') %>

    <!-- mobile-app-meta.ejs probably also references safeServiceData if it’s using that; 
         make sure it does not need a separate include of meta-helpers -->
    <%- include('../Partials/mobile-app-meta') %>

    <!-- Essential CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <link href="/css/apartment-security.css" rel="stylesheet">

    <!-- JSON-LD & Schema Partials (they may also use safeServiceData internally) -->
    <%- include('../Partials/schema-primary') %>
    <%- include('../Partials/schema-service') %>
    <%- include('../Partials/schema-faq-service') %>
    <%- include('../Partials/tracking-scripts') %>
</head>

<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <%- include('../Partials/Header') %>

    <main id="main-content">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="container">
                <h1 class="hero-title speakable-intro">
                  Professional Apartment Security Services
                </h1>
                <p class="hero-subtitle speakable-intro">
                  Protecting residential communities with comprehensive security solutions tailored to modern apartment living
                </p>
            </div>
        </section>

        <!-- Premier Overview Section -->
        <div style="background-color:#ffffff; padding:60px; border-radius:14px;
            font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color:#1c1c1c; max-width:960px; margin:60px auto;
            box-shadow:0 10px 30px rgba(0,0,0,0.1); border:1px solid #e0e0e0;">
            <h1 style="font-size:38px; margin-bottom:28px; color:#152f45;">
                Premier Apartment Security Services for Complete Residential Protection
            </h1>
            <p class="speakable-services" style="font-size:20px; line-height:1.8; margin-bottom:0;">
                <strong>ShieldWise Security</strong> understands that effective apartment security combines a warm,
                community-first approach with uncompromising protection. We employ state-of-the-art
                <strong style="color:#bf9e5b;">access control</strong> systems, high-definition cameras with
                <strong style="color:#bf9e5b;">24/7 video monitoring</strong>, reinforced
                <strong style="color:#bf9e5b;">perimeter defenses</strong>, and customized
                <strong style="color:#bf9e5b;">emergency response plans</strong> to ensure comprehensive protection
                for your residential community.
            </p>
            <div class="speakable-contact" style="margin-top:20px; font-size:18px;">
                <strong>Call This Number:</strong> +1-714-716-7430 |
                <strong>Email:</strong> info@shieldwisesecurity.com
            </div>
        </div>

        <!-- Apartment Security Features Section -->
        <section id="features" class="apartment-features-section">
            <div class="container">
                <h2 class="section-title">Comprehensive Apartment Security Features</h2>
                <p class="section-subtitle">Advanced security solutions designed specifically for residential communities</p>

                <div class="apartment-grid">
                    <div class="apartment-card">
                        <div class="apartment-icon"><i class="fas fa-key" aria-hidden="true"></i></div>
                        <h3 class="apartment-title">Access Control Systems</h3>
                        <p class="apartment-description">
                          Smart key card systems, intercom management, visitor verification, and secure entry protocols for all building access points.
                        </p>
                    </div>
                    <div class="apartment-card">
                        <div class="apartment-icon"><i class="fas fa-video" aria-hidden="true"></i></div>
                        <h3 class="apartment-title">24/7 CCTV Monitoring</h3>
                        <p class="apartment-description">
                          Comprehensive surveillance coverage of lobbies, hallways, parking areas, and common spaces with real-time monitoring.
                        </p>
                    </div>
                    <div class="apartment-card">
                        <div class="apartment-icon"><i class="fas fa-shield-alt" aria-hidden="true"></i></div>
                        <h3 class="apartment-title">On-Site Security Personnel</h3>
                        <p class="apartment-description">
                          Professional security guards stationed at your property to provide immediate response and maintain a visible security presence.
                        </p>
                    </div>
                    <div class="apartment-card">
                        <div class="apartment-icon"><i class="fas fa-car" aria-hidden="true"></i></div>
                        <h3 class="apartment-title">Parking Area Security</h3>
                        <p class="apartment-description">
                          Dedicated surveillance and patrol of parking garages, guest parking, and vehicle security to prevent theft and vandalism.
                        </p>
                    </div>
                    <div class="apartment-card">
                        <div class="apartment-icon"><i class="fas fa-phone" aria-hidden="true"></i></div>
                        <h3 class="apartment-title">Emergency Response</h3>
                        <p class="apartment-description">
                          Rapid response protocols for medical emergencies, security incidents, and coordination with local law enforcement.
                        </p>
                    </div>
                    <div class="apartment-card">
                        <div class="apartment-icon"><i class="fas fa-users" aria-hidden="true"></i></div>
                        <h3 class="apartment-title">Visitor Management</h3>
                        <p class="apartment-description">
                          Comprehensive visitor screening, guest registration, delivery coordination, and contractor access management.
                        </p>
                    </div>
                    <div class="apartment-card">
                        <div class="apartment-icon"><i class="fas fa-mobile-alt" aria-hidden="true"></i></div>
                        <h3 class="apartment-title">Mobile Patrol Services</h3>
                        <p class="apartment-description">
                          Regular security patrols of property perimeter, common areas, and surrounding neighborhood for enhanced protection.
                        </p>
                    </div>
                    <div class="apartment-card">
                        <div class="apartment-icon"><i class="fas fa-clipboard-check" aria-hidden="true"></i></div>
                        <h3 class="apartment-title">Incident Reporting</h3>
                        <p class="apartment-description">
                          Detailed incident documentation, security logs, and regular reporting to property management and residents.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- (The rest of your page content…) -->
    </main>

    <%- include('../Partials/Footer') %>

    <!-- Structured Data for Voice Search -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "speakable": {
        "@type": "SpeakableSpecification",
        "cssSelector": [
          ".speakable-intro",
          ".speakable-services",
          ".speakable-contact"
        ]
      },
      "url": "https://shieldwisesecurity.com/services/apartment-security"
    }
    </script>

    <!-- Essential Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js" defer></script>
    <script>
      // (Your smooth‐scroll, intersection observer, counter animation, etc…)
    </script>

    <!-- Deferred Tracking Scripts -->
    <%- include('../Partials/tracking-scripts-deferred') %>
</body>
</html>
Summary of the changes
At the very top of apartment-security.ejs, we did:

ejs
Copy
Edit
<%- include('../Partials/meta-helpers', { serviceData: serviceData }) %>
This brings all helper functions and the safeServiceData object into the parent scope immediately.

Because safeServiceData is now defined for the entire parent template, both:

<%- include('../Partials/meta-tags-service') %>

<%- include('../Partials/performance-optimization') %>

can safely reference safeServiceData (and the helper functions) without throwing a ReferenceError.

You do not need to pass serviceData again into meta-tags-service or performance-optimization; they both implicitly see safeServiceData that was built at the very top.

After making these changes, restart your server and visit:

bash
Copy
Edit
http://localhost:3000/services/apartment-security
You should no longer see:

vbnet
Copy
Edit
ReferenceError: …/performance-optimization.ejs: safeServiceData is not defined
Everything that needs safeServiceData now has it in scope.