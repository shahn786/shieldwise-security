
// ULTIMATE 2025 PERFORMANCE OPTIMIZATION - CORE WEB VITALS & AI SEARCH ENGINES
document.addEventListener("DOMContentLoaded",function(){
// Critical Performance Metrics Tracking
const perfObserver=new PerformanceObserver(list=>{
for(const entry of list.getEntries()){
if(entry.entryType==="largest-contentful-paint"){
console.log("LCP:",entry.startTime);
if(entry.startTime>2500){document.body.classList.add("slow-lcp")}
}
if(entry.entryType==="first-input"){
console.log("FID:",entry.processingStart-entry.startTime);
if((entry.processingStart-entry.startTime)>100){document.body.classList.add("slow-fid")}
}
if(entry.entryType==="layout-shift"){
if(!entry.hadRecentInput&&entry.value>0.1){
console.log("CLS:",entry.value);document.body.classList.add("high-cls")
}}}});

// Enhanced Web Vitals Monitoring
if("PerformanceObserver"in window){
try{
perfObserver.observe({type:"largest-contentful-paint",buffered:!0});
perfObserver.observe({type:"first-input",buffered:!0});
perfObserver.observe({type:"layout-shift",buffered:!0})
}catch(e){console.warn("Performance Observer not fully supported:",e)}
}

// AI Search Engine Optimization
const aiSearchOptimization={
structuredData:function(){
const jsonLd=document.querySelector('script[type="application/ld+json"]');
if(jsonLd){
try{
const data=JSON.parse(jsonLd.textContent);
data.dateModified=new Date().toISOString();
data.lastReviewed=new Date().toISOString();
jsonLd.textContent=JSON.stringify(data)
}catch(e){console.warn("JSON-LD update failed:",e)}
}},
enhanceMetaTags:function(){
const metaTags=document.querySelectorAll("meta[name^='ai-']");
metaTags.forEach(tag=>{
const content=tag.getAttribute("content");
if(content&&!content.includes(new Date().getFullYear())){
tag.setAttribute("content",content+" - Updated "+new Date().getFullYear())
}})},
semanticMarkup:function(){
document.querySelectorAll("h1,h2,h3").forEach(heading=>{
if(!heading.hasAttribute("id")){
heading.id=heading.textContent.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")
}});
document.querySelectorAll("img").forEach(img=>{
if(!img.hasAttribute("alt")||img.alt===""){
const src=img.src||"";
const filename=src.split("/").pop().split(".")[0];
img.alt="Professional security services - "+filename.replace(/[-_]/g," ")
}})
}};

// Execute AI Optimizations
aiSearchOptimization.structuredData();
aiSearchOptimization.enhanceMetaTags();
aiSearchOptimization.semanticMarkup();

// Enhanced Image Optimization
const imageOptimization=function(){
const images=document.querySelectorAll("img[data-src],img[loading='lazy']");
const imageObserver=new IntersectionObserver((entries,observer)=>{
entries.forEach(entry=>{
if(entry.isIntersecting){
const img=entry.target;
if(img.dataset.src){
img.src=img.dataset.src;
img.removeAttribute("data-src")
}
img.classList.add("loaded");
observer.unobserve(img)
}})},{rootMargin:"50px"});
images.forEach(img=>imageObserver.observe(img))
};

if("IntersectionObserver"in window){imageOptimization()}

// Critical Resource Preloading
const criticalResources=["css","js","fonts"];
criticalResources.forEach(type=>{
document.querySelectorAll(`link[rel="preload"][as="${type}"]`).forEach(link=>{
if(type==="css"&&!link.onload){
link.onload=function(){this.onload=null;this.rel="stylesheet"}
}})});

// Enhanced Font Loading with FOUT Prevention
if("fonts"in document){
document.fonts.ready.then(()=>{
document.documentElement.classList.add("fonts-loaded");
// Measure typography-related CLS
new ResizeObserver(entries=>{
entries.forEach(entry=>{
if(entry.target.tagName.match(/^H[1-6]$/)){
entry.target.style.fontDisplay="swap"
}})}).observe(document.body)
})
}

// Service Worker Registration for PWA Features
if("serviceWorker"in navigator){
window.addEventListener("load",()=>{
navigator.serviceWorker.register("/sw.js").then(registration=>{
console.log("SW registered:",registration.scope)
}).catch(registrationError=>{
console.log("SW registration failed:",registrationError)
})})
}

// Enhanced Back to Top Button
const backToTop=document.getElementById("backToTop")||document.querySelector(".back-to-top");
if(backToTop){
const toggleBackToTop=()=>{
backToTop.style.display=window.pageYOffset>300?"block":"none"
};
window.addEventListener("scroll",toggleBackToTop,{passive:!0});
backToTop.addEventListener("click",e=>{
e.preventDefault();
window.scrollTo({top:0,behavior:"smooth"})
})
}

// Critical CSS Injection for Above-Fold Content
const criticalCSS=`
.hero-section{background:linear-gradient(135deg,#1a3c6e 0%,#2d5a96 100%);color:#fff;padding:60px 0}
.btn-primary{background:#1a3c6e;border:#1a3c6e;transition:all .3s ease}
.btn-primary:hover{background:#2d5a96;transform:translateY(-2px)}
.security-card{box-shadow:0 4px 15px rgba(0,0,0,.1);transition:transform .3s ease}
.security-card:hover{transform:translateY(-5px)}
`;

const styleSheet=document.createElement("style");
styleSheet.textContent=criticalCSS;
document.head.appendChild(styleSheet);

// Enhanced Analytics and Conversion Tracking
const trackUserInteraction=function(){
["click","scroll","keydown"].forEach(event=>{
document.addEventListener(event,function handler(){
if("gtag"in window){
gtag("event","user_engagement",{
engagement_time_msec:Date.now()-performance.timing.navigationStart
})
}
document.removeEventListener(event,handler)
},{once:!0})
})
};
trackUserInteraction();

// AI Search Readability Enhancement
const enhanceReadability=function(){
document.querySelectorAll("p").forEach(p=>{
const wordCount=p.textContent.split(" ").length;
if(wordCount>50){p.classList.add("long-paragraph")}
});
document.querySelectorAll("ul,ol").forEach(list=>{
if(list.children.length>5){list.classList.add("long-list")}
})
};
enhanceReadability();

// Emergency Contact Optimization
const phoneNumbers=document.querySelectorAll('a[href^="tel:"]');
phoneNumbers.forEach(phone=>{
phone.addEventListener("click",()=>{
if("gtag"in window){
gtag("event","phone_call",{
event_category:"contact",
event_label:phone.href.replace("tel:","")
})
}})
});

// Schema.org Microdata Enhancement
const enhanceMicrodata=function(){
document.querySelectorAll("[itemscope]").forEach(element=>{
if(!element.hasAttribute("itemid")){
element.setAttribute("itemid",window.location.href+"#"+element.tagName.toLowerCase())
}})
};
enhanceMicrodata();

console.log("2025 Performance optimization and AI search enhancement loaded successfully.")
});
